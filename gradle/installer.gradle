ssh.settings {
    knownHosts = allowAnyHosts
}

def installerGroup = "ELJ-Installer"

task getInstaller {
    group installerGroup
    doLast {
        ssh.run {
            session(remotes.ev3dev) {
                sshPrint(delegate,  "wget -N https://raw.githubusercontent.com/ev3dev-lang-java/installer/master/installer.sh -O /home/robot/java/installer.sh")
                sshPrint(delegate,  "chmod +x /home/robot/java/installer.sh")
            }
        }
    }
}

task helpInstall {
    group installerGroup
    doLast {
        ssh.run {
            session(remotes.ev3dev) {
                sshPrint(delegate, "/home/robot/java/installer.sh help")
            }
        }
    }
}

task installJava {
    group installerGroup
    doLast {
        ssh.run {
            session(remotes.ev3dev) {
                sshPrint(delegate, "echo -e \"${project.brickPassword}\" | sudo -S /home/robot/java/installer.sh java")
            }
        }
    }
}

task installNativeLibraries {
    group installerGroup
    doLast {
        ssh.run {
            session(remotes.ev3dev) {
                sshPrint(delegate, "echo -e \"${project.brickPassword}\" | sudo -S /home/robot/java/installer.sh libs")
            }
        }
    }
}

task javaVersion {
    group installerGroup
    doLast {
        ssh.run {
            session(remotes.ev3dev) {
                sshPrint(delegate, "java -version")
            }
        }
    }
}

task installLibraries {
    group installerGroup
    doLast {
        ssh.run {
            session(remotes.ev3dev) {
                sshPrint(delegate, "rm -rf ${project.externalJarsPath}")
                sshPrint(delegate, "mkdir -p ${project.externalJarsPath}/")
                configurations.runtime.each {
                    println "Uploading: ${it.name}"
                    delegate.put from: it.path, into: "${project.externalJarsPath}"
                }
            }
        }
    }
}


apply from: './config.gradle'
